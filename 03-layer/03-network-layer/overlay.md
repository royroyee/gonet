# Overlay Network
****Layer 3, Network Layer 에서 작동하며 IP 패킷을 전송하는 역할을 한다.****

### 사전지식
[VLAN](https://github.com/royroyee/gonet/tree/main/03-layer/02-data-link-layer#vlanvirtual-lan)

## Overlay Network 란?
> 가상 네트워크를 구성하는 방법 중 하나로, 물리적인 네트워크 상에서 동작하는 가상 네트워크
- 가상 노드가 물리적으로 연결되어 있지 않아도, 가상 네트워크 상에서 연결이 가능하다.
  - 이를 위해 가상 네트워크 상에서 각 가상 노드에 고유한 IP 주소를 할당해야 한다.
  - 가상으로 연결된 노드들은 서로 라우팅을 통해 통신할 수 있다.
- 가상 네트워크를 물리적 네트워크와 분리시켜주는 것

### 등장 배경
- 기존의 물리적인 네트워크 환경에서는 호스트와 물리적인 네트워크 사이에 [NAT](https://github.com/royroyee/gonet/tree/main/03-layer/03-network-layer#natnetwork-address-translation)나, 라우터를 이용하여 서로 다른 네트워크 간에 통신을 가능하게 했는데, 가상화된 환경에서는 이러한 방식으로 네트워크를 구성하는 것이 더 이상 적합하지 않았다.
  - 각각의 컨테이너는 호스트 시스템의 IP 주소를 공유하게 되어 컨테이너가 서로 다른 호스트에서 실행되는 경우 문제가 발생할 수 있기 때문


- 이러한 문제를 해결하기 위해 가상화된 네트워크를 구성하여, 여러 호스트에 분산된 컨테이너 간에 투명하게 통신할 수 있도록 하는 오버레이 네트워크가 등장했다.

### 장점
- 오버레이 네트워크는 물리적인 네트워크를 기반으로 하지만 가상화된 네트워크로 추상화되어 있어, 컨테이너가 물리적인 네트워크의 제약을 받지 않고 서로 통신할 수 있다.
- 이를 통해 컨테이너화된 애플리케이션의 배포와 확장성이 쉬워진다.

### 동작 방식
1. 가상 네트워크 생성 : 오버레이 네트워크는 가상 네트워크를 생성한다. 
   - `가상 네트워크`는 물리적인 네트워크 상에서 동작하며, 가상 머신이나 컨테이너 등 가상화된 환경에서도 동작할 수 있다.


2. 가상 네트워크에 노드 추가 : 가상 네트워크에 노드를 추가한다.  
   - `노드`는 가상 머신이나 컨테이너 등 가상화된 환경에서 동작하는 것으로, 물리적인 네트워크 상에서는 IP 주소나 MAC 주소를 가지고 있지 않는다.


3. 가상 노드 간 통신 : 가상 노드 간에는 가상적인 터널을 만들어서 통신한다.
   - `가상적인 터널`은 오버레이 네트워크에서 자동으로 생성되며, 가상 노드끼리의 통신은 이 가상적인 터널을 통해 이루어진다.


4. 오버레이 네트워크에서의 통신 : 가상 노드 간의 통신은 오버레이 네트워크 상에서 이루어지기 때문에, 물리적인 네트워크 상에서는 볼 수 없다.
   - 따라서, 오버레이 네트워크 상에서의 통신은 암호화되어 있을 수 있다.


### 대표 예시
> 컨테이너, 클라우드 등 대규모 분산 시스템에서 많이 사용된다.
- VPN
- Docker Network
- Kubernetes Network (Flannel 등)

### 종류
- `VXLAN` : 네트워크 오버레이 기술 중 가장 주목받는 기술 중 하나
- `GRE` 

> 주의. VLAN 방식 오버레이 네트워크가 아니다. 물리적인 네트워크 위에 논리적인 네트워크를 구성하는 것이 아니기 때문이다.

---

## VXLAN
> 가상 네트워크 기술로 IP 네트워크 상에서 가상 네트워크를 구성하는 방법
- 여러 개의 물리 네트워크 상에서 동작하는 서로 다른 가상 네트워크를 마치 하나의 네트워크처럼 구성할 수 있다.
- VLAN 과는 기술적으로 다르며, vlan 보다 더 많은 가상 네트워크를 지원한다.
  - 자세한 내용은 추후 작성 예정
- 대표 예시 : Kubernetes Network Plugin