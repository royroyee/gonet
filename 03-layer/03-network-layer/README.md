# Layer 3,  Network Layer
Layer 3 - 네트워크 계층

03-data-link-layer 에서 배운 데이터 링크 계층으로만은 인터넷이나 다른 네트워크로는 데이터를 전송할 수 없다. (같은 네트워크에 있는 컴퓨터로만 데이터 전송이 가능)
> 네트워크 간의 통신을 가능하게 하는 것이 네트워크 계층의 역할

## 라우터(Router)
- NAT기능을 가진 외부 네트워크와 내부 네트워크를 연결해주는 하나의 장치
- 서로 다른 네트워크 간에 통신을 하려면 라우터가 필요 (L3 스위치가 라우터의 역할을 하기도 한다.)
> 라우터를 통해 네트워크를 분리할 수 있다.

## 라우팅(Routing)
>IP 주소로 목적지를 지정하는 것 뿐만 아니라 **어떤 경로**로 보낼지도 결정해야 한다.
- 목적지 IP 주소까지 어떤 경로로 데이터를 보낼지 결정하는 것을 라우팅 이라고 한다.
- 현재 네트워크에서 다른 네트워크로 최적의 경로를 통해 데이터를 전송한다.
  - 이 경로 정보가 등록되어 있는 테이블을 **라우팅 테이블** 이라고 한다.
  
### 스위치 vs 라우터
> 스위치의 목적 : 여러 장치를 연결하여 네트워크 생성
> 
> 라우터의 목적 : 서로 다른 네트워크를 연결
1. **계층** : 스위치는 데이터링크 계층에서 MAC 주소를 기반으로, 라우터는 네트워크 계층에서 IP 주소를 기반으로 동작
2. **브로드캐스트 도메인 구분** : 스위치는 불가능, 라우터는 가능
   - `브로드캐스트 도메인` : 브로드캐스트 패킷이 도달할 수 있는 영역
   - 스위치 : 스위치 내에 연결된 모든 포트에 데이터를 전송한다. 이러한 동작 방식은 대규모 네트워크에서 브로드캐스트 패킷이 전체 네트워크 대역폭을 차지하고, 네트워크 성능을 떨어뜨리는 원인이 된다.
   - 라우터 : 라우터는 라우팅 테이블을 사용하여 패킷을 전송하는데, 라우팅 테이블은 목적지 주소를 기반으로 전송 유무를 결정하므로 브로드캐스트 도메인을 구분할 수 있다.
3. **불명확한 목적지를 가진 데이터 처리** : 스위치는 모든 포트로 데이터를 전송하는 브로드캐스트를 동작, 라우터는 목적지가 불명확한 데이터는 버린다.
4. **관리자 설정** : 스위치는 필요 없으나, 라우터는 관리자의 설정으로 라우팅 테이블 생성 및 통신을 해야한다.

## 게이트웨이(Gateway)
- 서로 다른 두 개 이상의 네트워크를 연결하여 통신이 가능하게 해주는 역할
- **다른 네트워크 영역으로 가기 위해 필수적으로 거쳐야 하는 곳** 이며 외부는 다른 프로토콜을 이용하여 통신한다.
  - 다른 네트워크 영역으로 가기 위해 프로토콜 변환 등 다양한 기능이 숨어져있다.
  - 프록시 서버 등과 역할은 유사하나, 프록시 서버는 게이트웨이와는 조금 개념이 다르며, 5~7계층에서 작동한다.

## IP
> LAN 에서는 MAC 주소만으로도 통신이 가능하지만, 다른 네트워크에는 데이터를 보낼 수 없다. MAC 주소가 아닌 네트워크를 식별할 수 있는 다른 주소
- IP 주소로 어떤 컴퓨터로 데이터를 보낼 지 목적지를 설정한다.
- 네트워크 계층의 대표적인 프로토콜
- 네트워크 계층에서 캡슐화를 할 때, 데이터에 `IP 헤더` 를 붙인다.
  - 이를 `IP 패킷` 이라고 한다.
  - IP 헤더의 주요 요소 : 출발지/목적지 IP 주소


## IP 주소
- IP 주소는 인터넷 서비스 제공자(ISP)에게 받을 수 있다.
- 32비트, 구분하기 쉽도록 10진수로 표시
- IP 버전 : IPv4 / IPv6
- 유형 : 공인 IP 주소 / 사설 IP 주소
- 네트워크 ID / 호스트 ID 두 가지 정보가 합쳐저서 IP 주소를 이룸
  - `공인 IP 주소` : 인터넷에 직접 연결되는 컴퓨터나 라우터에 할당
  - `사설 IP 주소` : 회사나 가정의 LAN에 있는 컴퓨터에 할당
  > 공인 IP 주소를 절약하기 위해 라우터에만 할당하고 LAN 안에 있는 컴퓨터에는 LAN의 네트워크 관리자가 자유롭게 사설 IP 주소를 할당하거나 라우터의 DHCP 기능을 사용하여 주소를 자동으로 할당한다.
  - `네트워크 ID` : 어떤 네트워크 인지를 나타낸다.
  - `호스트 ID` : 해당 네트워크의 어느 컴퓨터인지 나타낸다.

### IPv4
- 32비트 , 약 43억개의 IP 주소 생성 가능 (초기에 43억개 정도로도 충분하다고 생각했었음)

### IPv6 
- 128비트, 약 340간 개의 IP 주소 생성 가능
- 급속도로 고갈된 IP 주소의 대책으로 생겨난 프로토콜

## IP 주소 클래스
- 네트워크 ID 와 호스트 ID 의 크기는 클래스마다 다르다.
- A~E 클래스가 있지만 C 까지만 서술한다.
- 네트워크 ID 비트가 적을 수록 큰 네트워크

### A 클래스
- 대규모 네트워크 주소
- `네트워크 ID` : 앞 8비트
- `호스트 ID` : 뒤 24비트
- 사설 IP 주소 범위 : 10.0.0.0 ~ 10.255.255.255

### B 클래스
- 중형 네트워크 주소
- `네트워크 ID` : 앞 16비트
- `호스트 ID` : 뒤 16비트
- 사설 IP 주소 범위 : 172.16.0.0 ~ 172.31.255.255

### C 클래스
- 소규모 네트워크 주소
- `네트워크 ID` : 앞 24비트
- `소규모 ID` : 뒤 24비트
- 사설 IP 주소 범위 : 192.168.0.0 ~ 192.168.255.255


## 네트워크 & 브로드캐스트 주소
- 컴퓨터나 라우터가 자신의 IP 주소로 사용하면 안 되는 주소

### 네트워크 주소
- 호스트 ID가 10진수로 0인 주소
- 전체 네트워크에서 **작은 네트워크** 를 식별하는 데 사용되고 그 네트워크 전체를 대표하는 주소
  - 한 마디로 **전체 네트워크의 대표 주소**
  - ex) `192.168.2.0` : 192.168.2.0 ~ 192.168.2.255 를 대표하는 주소

### 브로드캐스트 주소
- 네트워크에 있는 컴퓨터나 장비 모두에게 한 번에 데이터를 전송하는 데 사용되는 전용 IP 
> 브로드캐스팅은 송신 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전송되는 방식을 의미한다.
- 호스트 ID 가 10진수로 255인 주소
  - ex) `192.168.1.255` : 이 주소로 데이터를 전송하면 네트워크 안에 있는 모든 컴퓨터가 데이터를 받게 된다. (브로드캐스팅)
    > 멀티캐스트 : 네트워크 상의 특정한 그룹에 속한 호스트들에게 데이터를 전송하는 방식으로, 멀티캐스트 패킷은 멀티캐스트 그룹에 속한 호스트들만 수신 가능
    > 브로드캐스트 : 네트워크 상의 모든 호스트들에게 데이터를 전송하는 방식으로, 브로드캐스트 패킷은 네트워크 상의 모든 호스트가 수신 가능


## 서브넷
- 네트워크를 `클래스` 로만 나누는 것은 매우 비효율적이다.
- 예를들어, A 클래스에서 호스트 ID 는 24비트에 달한다. 이 많은 네트워크에 브로드캐스트 패킷을 전송하면 매우 비효율적 
- 또는 기업 마다 네트워크 ID, 호스트 ID 의 수요가 크게 다를 텐데, 클래스만으로 나누는 것은 비효율적
> 때문에, 네트워크를 작은 네트워크로 분할하는 것을 서브넷팅 이라고 한다. 이렇게 분할된 네트워크를 서브넷이라고 한다.

- `네트워크 ID` , `서브넷 ID` , `호스트 ID` 로 나누어지게 된다.
## 서브넷 마스크
> 네트워크 ID와 호스트 ID 를 식별하기 위한 값
- 위에서 `서브넷 ID` 가 추가되었는데, 이렇게 서브넷팅을 해버리면 어디까지가 네트워크 ID 인지 등의 판별이 어려워진다.
- 이런 문제를 해결하기 위해 **서브넷 마스크** 를 이용한다.
- 정확한 구분 방법들은 추후 작성 예정
> 프리픽스 표기법 : IP 주소에서 네트워크 부분을 나타내는 방법 중 하나. IP 주소와 함께 슬래시(/)로 구분되며 네트워크 ID의 비트 수를 나타낸다
> 
> 예를 들어, 192.168.1.0/24라는 IP 주소는 24비트가 네트워크 ID, 나머지 8비트는 호스트ID 를 나타낸다.