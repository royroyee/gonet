# Layer 2, Data Link Layer & Ethernet

## 데이터 링크 계층 (Data Link Layer)
- 데이터 링크 계층은 OSI 모델 7계층에서의 두 번째 계층으로 **네트워크 장비 간에 신호를 주고받는 규칙** 을 정하는 계층
- **LAN**에서 데이터를 정상적으로 주고받기 위해 필요한 계층
- 이러한 규칙들 중에 가장 많이 사용되는 규칙이 **이더넷**

### 허브
- 랜을 구성할 때 한 사무실이나 가까운 거리에 있는 장비들을 케이블을 사용하여 연결하는 장치
- 포트가 여러개여서 여러개의 컴퓨터에 데이터를 보낼 수 있다.
- 단, 특정한 컴퓨터 한 대에 데이터를 보내려고 해도 포트로 연결되어있는 다른 모든 컴퓨터에 전기 신호가 전달한다. (때문에 더미 허브라고도 불린다.)
  - 때문에 컴퓨터 여러 대가 동시에 데이터를 보내면 데이터들이 서로 부딪힐 수 있다. (충돌)
---
## 이더넷 (Ethernet)
- 유/무선 통신장비 공유기, 허브 등을 통해 **다수의 시스템이 LAN 선 및 통신포트에 연결되어 통신이 가능한 네트워크 구조**
- LAN 에서 가장 많이 쓰이는 기술 규격
- 위에서 언급한 여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않는 구조로 이루어져 있다.
  - 데이터가 동시에 케이블을 지나가면 충돌 할 수 밖에 없기 때문에, 데이터를 보내는 시점을 늦춘다.
  - 이처럼 이더넷에서 시점을 늦추는 방법을 `CSMA/CD` 라고 한다. 
---
## MAC 주소
- 랜 카드는 비트열(0,1)을 전기 신호로 변환한다. 이러한 랜 카드에는 **MAC 주소** 라는 번호가 정해져 있다.
  - 물리 주소라고도 부르며 전 세계에서 유일한 번호로 할당
- 48비트 숫자로 구성
  - 앞 24비트 : 랜 카드를 만든 제조사
  - 뒤 24비트 : 제조사가 랜 카드에 붙인 일련번호
  - 구분하기 쉽도록 16진수로 표기
> IP 주소 : 레이어 3 의 네트워크 에서 사용
> 
> MAC 주소 : 레이어 2 의 데이터 링크 에서 사용

### MAC 주소의 필요성
- 같은 네트워크 공간에 있는 컴퓨터와 통신을 하기 위해서
- 서로 다른 네트워크 사이에서는 [IP](https://github.com/royroyee/gonet/tree/main/03-layer/03-network-layer#ip) 주소가 필요한 데, IP 주소만으로는 네트워크 구분만 할 수 있다고 봐도 된다. 이때도 물리적 주소인 MAC 주소를 알아야 특정 컴퓨터와 통신할 수 있다.

### MAC 주소를 사용한 통신
- OSI, TCP/IP 모델의 각 계층에선 헤더를 붙인다. (캡슐화)
- 이 계층에서(OSI: 테이터 링크 계층 , TCP/IP: 네트워크 계층) `이더넷 헤더`와 `트레일러`를 붙인다.
- 이더넷 헤더와 트레일러가 추가된 데이터를 `프레임` 이라고 한다. (네트워크를 통해 `프레임` 이 전송되는 것이다.)

### 이더넷 헤더
- 목적지 MAC 주소(6바이트) + 출발지 MAC 주소(6바이트) + 유형(2바이트)
  - `이더넷 유형` : 이더넷으로 전송되는 상위 계층 프로토콜 종류를 나타낸다. 즉 **프로토콜 종류를 식별하는 번호**가 들어간다.
    - ex) 0800 : IPv4 , 86DD IPv6

### 트레일러
- FCS(Frame Check Sequence) 라고도 하며 데이터 전송 도중에 오류가 발생하는 지 확인하는 용도로 사용

### Example
- 컴퓨터1 이 컴퓨터2 로 데이터를 전송할 때 (허브에 연결되어 있는 상태)
    1. 컴퓨터1은 이더넷 헤더에 데이터의 목적지인 컴퓨터2 의 MAC 주소 + 자신의 MAC 주소, 이더넷 유형을 넣고 데이터(프레임)를 전송 (캡슐화)
    2. 컴퓨터1이 보낸 데이터를 포트로 수신하고 모든 포트로 전송한다.
    3. 컴퓨터2 가 아닌 나머지 컴퓨터들은 목적지 MAC 주소가 자신의 MAC 주소와 다르기 때문에 **데이터를 파기**
    4. 컴퓨터2 는 자신의 MAC 주소가 목적지 MAC 주소와 같으므로 데이터를 수신
    5. 컴퓨터2 는 물리 계층에서 전기 신호로 전송된 데이터를 비트열로 변환하고 데이터 링크 계층에서 이더넷 헤더와 트레일러를 분리 (역 캡슐화)
> 컴퓨터 1,2 가 동시에 컴퓨터3 에 데이터를 전송하는 경우 충돌 방지를 위해 CSMA/CD 방식 사용

---

## 스위치(Switch)
- 데이터 링크 계층에서 동작하고 `레이어2 스위치` 또는 `스위칭 허브`라고도 불린다. (외형은 허브와 비슷)
- 목적지로 출발한 데이터를 중간에 적합한 경로로 스위칭 해주는 역할을 하며, 데이터링크 계층에 속하므로 **MAC 주소** 기반으로 동작한다.
- 현재 대부분 이더넷을 사용한다.
- 여러 장치를 연결하여 근거리 통신망(LAN)을 형성한다. 때문에 도착한 패킷을 특정 장치로 전달하는 것은 스위치가 담당한다.

### MAC 주소 테이블
- 스위치의 포트 번호와 해당 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되는 데이터베이스
- 스위치가 전원을 켠 상태에서는 MAC 주소 테이블에 아무것도 등록되어 있지 않다.
- 컴퓨터에서 `프레임` 데이터가 전송되면 MAC 주소 테이블을 확인하고 출발지 MAC 주소가 등록되어 있지 않으면 `MAC 주소`와 `포트`를 함께 등록
  - MAC 주소 학습 기능 이라고도 함

### 플러딩
 1. 컴퓨터 1이 컴퓨터2에 프레임(데이터)를 전송한다. (컴퓨터1 이외의 컴퓨터는 MAC 주소 테이블에 아직 등록되어 있지 않다고 가정)
 2. 컴퓨터2 이외의 컴퓨터에도 프레임이 전송된다.

이러한 것을 `플러딩` 이라고 한다.

---

## ARP(Address Resolution Protocol)
사전지식 [IP](https://github.com/royroyee/gonet/tree/main/03-layer/03-network-layer#ip)
- 목적지 컴퓨터의 IP 주소를 이용하여 MAC 주소를 찾기 위한 프로토콜 (IP 주소를 MAC 주소와 매칭 시키기 위한 프로토콜)
> ARP 요청 : 출발지 컴퓨터가 이더넷 프레임을 전송하려면 목적지 컴퓨터의 MAC 주소를 지정해야 하는데, 이를 모를 때 MAC 주소를 알아내기 위해 네트워크에 브로드캐스트를 하는 것

> APR 응답 : 위의 요청에 대해 지정된 IP 주소를 갖고 있는 컴퓨터가 MAC 주소를 응답으로 보내는 것
- IP 주소와 MAC 주소를 일대일 매칭하여 LAN(Layer 2)에서 목적지를 제대로 찾아갈 수 있도록 돕는다.

### ARP Table
- IP 주소와 MAC 주소를 일대일 매칭시킨 정보를 정리해둔 Table

---

## VLAN

### 등장 배경
- 레이어2 스위치는 하나의 이더넷 네트워크를 구성하는 네트워크 기기인데, 하나의 네트워크에 수많은 기기를 연결하면 불필요한 데이터 전송이 많이 발생하게 된다.
> 이러한 문제를 해결하기 위해 레이어2 스위치에서 '하나'의 네트워크를 구성하는 방식이 아닌, 네트워크를 복수로 분할할 수 있게 하는 기술이 등장


### 동작원리
- 일반 레이어2 스위치는 모든 포트 사이에서 이더넷 프레임을 전송할 수 있는데, 이것을 VLAN으로 나누어 **같은 VLAN에 할당된 포트끼리만 이더넷 프레임을 전송**하도록 한다.
- MAC 주소 테이블에 VLAN ID 가 저장된다 
  - 예시 (MAC 주소 테이블, 이더넷 헤더)
  - 포트 1 : MAC 주소 AAA , VLAN 10
  - 포트 2 : MAC 주소 BBB, VLAN 10
  - 포트 3 : MAC 주소 CCC, VLAN 20
  - 포트 4 : MAC 주소 DDD, VLAN 20
  - 포트 1, 2에는 `VLAN10`, 포트 3,4 에는 `VLAN20` 이 할당되었다.
  - `VLAN10` 의 포트1,2만 이더넷 프레임 전송이 가능
  - `VLAN20` 의 포트 3,4만 이더넷 프레임 전송이 가능
  > VLAN이 다른 포트 사이에서는 이더넷 프레임을 전송할 수 없다.(라우터, 레이어3 스위치 등이 필요하다.)
  
### 장점
- 레이어2 스위치를 가상으로 분할하는 것으로, **분할한 VLAN의 스위치가 될 포트는 자유롭게 결정**할 수 있다.
- VLAN 별 스위치 사이는 연결되어 있지 않으므로 데이터가 전송되는 범위를 제한할 수 있어 보안을 향상시킬 수 있다.

### 주의점
- network layer 에서 배울 라우터도 네트워크를 분리하지만, 라우터로 분할된 네트워크는 라우터로 서로 연결되어 있다.
- 단, VLAN을 통해 분할한 네트워크는 서로 통신하기 위해서난 라우터와 레이어3 스위치가 필요하다
  - VLAN 끼리 연결해서 서로 통신할 수 있게 하는 것을 VLAN 라우팅 이라고 한다.