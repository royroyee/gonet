# ip


## ip 데이터그램
![IP 헤더.png](img%2FIP%20%ED%97%A4%EB%8D%94.png)
> ip 계층 가변길이 패
- IP 헤더 : 20~40 bytes
- 라우팅 및 전달에 필요한 정보를 포함
- 4바이트 단위로 표시

### 구성 요소
- `VER`(버전) : 4비트, IP 프로토콜의 버전을 나타냄(현재 IPv4)


- `HLEN`(헤더 길이) : 4비트, 헤더 길이가 20~60바이트 사이에서 변할 수 있으므로 필요한 필드
  - 해당 값에 4를 곱하여 구한다.
  - 선택사항이 없다면 필드의 값은 5 (5*4 = 20)
  - 선택사항 필드가 최대 길이라면 값은 15 (15 * 4 = 60)


- `Service Type`(서비스 유형) : 서비스 유형에서의 우선순위 등을 표현
  - 자세한 내용 추후 작성 예정


- `Total length`(전체 길이) : 헤더와 데이터를 포함하는 전체 길이를 바이트 단위로 나타낸다.
  - 상위 계층으로부터 받은 데이터 길이를 알아내기 위해 전체 길이에서 헤더 길이를 빼면 된다.
  - 데이터 길이 = 전체 길이 - 헤더 길이(HLEN*4)


- `Identification`(식별) : : 생성되는 각각의 패킷마다 부여된느 고유의 번호. 
  - 패킷은 제 2계층 프로토콜의 최대 전송 단위(MTU) 값에 따라 여러 개의 프로그먼트(Fragment)로 분할되어 처리되는데, 분할되어 온 fragment들을 원래의 패킷으로 재조립할 때 이 식별자 값을 기준으로 한다.
    - 밑 단편화 참고


- `Flags` : IP 패킷(데이터그램)의 분할(fragmentation) 가능 여부와 마지막 fragment인지 아닌지를 알리기 위해 사용되는 필드.


- `Time to Live`(수명) : 제한된 수명, 값이 0이 되면 데이터그램은 폐기 된다.
  - 데이터그램에 의해 방문되는 최대 홉(라우터) 수를 제어하기 위해 사용
  - 각 라우터는 이 필드의 값을 1씩 감소시키며, 값이 0이 되면 라우터는 데이터그램을 폐기
  - 예시: 발신지가 패킷이 지역 네트워크 내에서만 전달되기를 원하여 값을 1로 설정 -> 첫 번째 라우터에서 0으로 감소되어 데이터그램이 폐기


- `Protocol` : 8비트, IP 계층의 서비스를 사용하는 상위 계층 프로토콜을 정의
  - IP 데이터그램은 TCP, UDP, ICMP, IGMP 등과 같은 여러 종류의 상위 계층 프로토콜을 캡슐화 할 수 있다.


- `Header Checksum` : IP 헤더의 오류 검사를 위한 필드. 
  - TCP와 UDP를 포함하여 IP 데이터그램으로 캡슐화되는 프로토콜은 대부분 헤더 및 데이터를 포함하는 체크섬 필드를 가지고 있기 때문에 IP 데이터그램의 체크섬 필드는 단순히 IP 헤더에 대한 오류 검사만을 수행.


- `Source IP Address` : 32비트, 발신지의 IP 주소를 정의
  - IP 데이터그램이 발신지에서 목적지까지 전달되는 동안 이 값은 변해서는 안 된다.


- `Destination Address` : 32비트, 목적지 IP 주소를 정의
  - 마찬가지로 전달되는 동안 변하지 않아야 할 값

## 단편화
데이터그램은 다른 네트워크를 지나갈 수 있다. 각 라우터는 수신한 프레임